--- 
title: "Data Visualisation `geom` Encyclopedia"
author: "Thiyanga S. Talagala"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  Collection of geom for data visualisation.
link-citations: yes
github-repo: thiyangt/geom.encyclopedia
output:
  pdf_document:
    citation_package: natbib
  bookdown::pdf_book:
    citation_package: biblatex
  toc: yes #if you want to get the table of contents
  fig_caption: true
---

# About

This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports; for example, a math equation $a^2 + b^2 = c^2$.

## Usage 

Each **bookdown** chapter is an .Rmd file, and each .Rmd file can contain one (and only one) chapter. A chapter *must* start with a first-level heading: `# A good chapter`, and can contain one (and only one) first-level heading.

Use second-level and higher headings within chapters like: `## A short section` or `### An even shorter section`.

The `index.Rmd` file is required, and is also your first book chapter. It will be the homepage when you render the book.

## Render book

You can render the HTML version of this example book without changing anything:

1. Find the **Build** pane in the RStudio IDE, and

1. Click on **Build Book**, then select your output format, or select "All formats" if you'd like to use multiple formats from the same book source files.

Or build the book from the R console:

```{r, eval=FALSE}
bookdown::render_book()
```

To render this example to PDF as a `bookdown::pdf_book`, you'll need to install XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.org/tinytex/>.

## Preview book

As you work, you may start a local server to live preview this HTML book. This preview will update as you edit the book when you save individual .Rmd files. You can start the server in a work session by using the RStudio add-in "Preview book", or from the R console:

```{r eval=FALSE}
bookdown::serve_book()
```


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Hello bookdown 

All chapters start with a first-level heading followed by your chapter title, like the line above. There should be only one first-level heading (`#`) per .Rmd file.

## A section

All chapter sections start with a second-level (`##`) or higher heading followed by your section title, like the sections above and below here. You can have as many as you want within a chapter.

### An unnumbered section {-}

Chapters and sections are numbered by default. To un-number a heading, add a `{.unnumbered}` or the shorter `{-}` at the end of the heading, like in this section.

<!--chapter:end:01-intro.Rmd-->

# Graph types {#cross}



## Chapters and sub-chapters


<!--chapter:end:02-cross-refs.Rmd-->

# R Packages

This chapter lists all the packages necessary for plotting

## Data processing

```{r}
library(tidyverse)
```

## Graph arrangement 

```{r}
library(patchwork)
```

## Data packages

### Cross sectional data

```{r}
#install_github("thiyangt/elephants")
library(elephants)
```

### Time series data

```{r}
#install_github("denguedatahub")
library(denguedatahub)
```

## Large cross sectional dataset

```{r}
data("elephants")
```

### Glimpse of the large dataset

```{r,echo=FALSE, message=FALSE, warning=FALSE,fig.width=20, fig.height=20}
GGally::ggpairs(elephants, aes(col=Gender)) +   scale_color_manual(values=c("male"="#d95f02","female"="#1b9e77")) + 
  scale_fill_manual(values=c("male"="#d95f02","female"="#1b9e77"))
```

## Small cross sectional dataset

```{r}
set.seed(2023)
elephants.subset.100 <- elephants |> sample_n(100)
```

### Glimpse of the small cross sectional dataset

```{r,echo=FALSE, message=FALSE, warning=FALSE,fig.width=20, fig.height=20}
GGally::ggpairs(elephants.subset.100, aes(col=Category)) + scale_color_manual(values=c("male"="#d95f02","female"="#1b9e77")) + 
  scale_fill_manual(values=c("male"="#d95f02","female"="#1b9e77"))
```

## Time series dataset

```{r}
library(denguedatahub)
srilanka_weekly_data
```


## Packages related to geom

```{r}
library(ggplot2)
#devtools::install_github("EvaMaeRey/ggxmean")
#library(gxmean)
#devtools::install_github("davidsjoberg/ggsankey")
library(ggxmean)
```

## geom Extensions

```{r}
library(GGally) # Matrix plots
```

## All available geom_... in the ggplot2 package

```{r, echo=FALSE}
ls(pattern = '^geom_', env = as.environment('package:ggplot2')) |> knitr::kable()
```

<!--chapter:end:03-parts.Rmd-->

# A: geom_a...

## geom_abline{#abline}

**Package: ** ggplot2 [@R-ggplot2]

**Book: **

**Description: ** Draw a straight line ($Y=mX+c$) for a given slope ($m$)  and intercept ($c$).

**See also: ** [geom_point](#point), [geom_vline](#vline), [geom_hline](#hline)

**Example:**

```{r, fig.cap="Illustration of (A) geom_abline and (B) use of geom_point and geom_abline both"}
abline <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) + geom_abline(intercept = 0.15, slope = 1.9) + 
  labs(title="A: `geom_abline` only") +
  theme(aspect.ratio = 1)

pointabline <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) + 
  geom_point() + 
  geom_abline(intercept = 0.15, slope = 1.9) + 
  labs(title="B: `geom_point + geom_abline` both") +
  theme(aspect.ratio = 1)

library(patchwork)
abline | pointabline
```

## geom_area{#area}

**Package: ** ggplot2 [@R-ggplot2]

**Description: **Create an area plot. This cover the space between x-axis and line that connects the data points.

**See also: ** [geom_line](#line)

```{r, fig.cap="Illustration of geom_area"}
colombo <- srilanka_weekly_data |>
  filter(district == "Colombo")
ggplot(data=colombo, aes(x=start.date, y=cases)) + 
  geom_area()
```

<!--chapter:end:04-a.Rmd-->

# B: geom_b...

## geom_bar

**Package: ** ggplot2 [@R-ggplot2]

**Description: ** Draw a bar proportional to the specified number. For example, number of cases or user defined number.

**Statistics layer(s): ** 

  `stat_count` - This the default statistics layer. It counts number of cases in each group. 
  
  `stat_identify` - It plots the data as it is.

**See also: ** [geom_col](#col)

### With count 

```{r, fig.cap="Illustration of geom_bar to create a bar chart"}
ggplot(elephants, aes(y = Age_Category)) + 
  geom_bar()

```

```{r, fig.cap="Illustration of geom_bar to create a stacked bar chart"}
ggplot(elephants, aes(y = Age_Category, fill=Category)) + 
  geom_bar()
```

```{r, fig.cap="Illustration of geom_bar to create a cluster bar chart"}
ggplot(elephants, aes(y=Age_Category, fill = Category)) +
  geom_bar(position = "dodge")
```

```{r, fig.cap="Illustration of geom_bar to create a cluster bar chart"}
ggplot(elephants, aes(y=Age_Category, fill = Category)) +
  geom_bar(position = "dodge")
```

### With identity

```{r}
dfbar <- data.frame(class=c("A", "B"),  income = c(100, 200))
ggplot(dfbar, aes(class, income)) +
  geom_bar(stat="identity")
```

## geom_bin_2d

**Package: ** ggplot2 [@R-ggplot2]

**Description: ** Divides the Cartesian plane created by x-variable and y-variable into rectangles, counts the number of observations in each rectangle. Only the observations with rectangles are filled according to the number ofobservations.

**Understandable aesthetics: ** x, y, fill, group

**Statistics layer(s): ** 


**See also: ** [geom_bin2d](#bin2d), [geom_point](#point)

```{r, fig.cap="Illustration of using geom_bin_2d"}
ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) +
  geom_bin_2d() + 
  theme(aspect.ratio = 1)
```

```{r, fig.cap="Illustration of changing bins in geom_bin_2d"}
ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) +
  geom_bin_2d(bins=20) + 
  theme(aspect.ratio = 1)
```

## geom_bin2d


**Package: ** ggplot2 [@R-ggplot2]

**Description: ** Divides the Cartesian plane created by x-variable and y-variable into rectangles, counts the number of observations in each rectangle. Only the observations with rectangles are filled according to the number ofobservations.

**Understandable aesthetics: ** x, y, fill, group

**Statistics layer(s): ** 


**See also: ** [geom_bin_2d](#bin_2d), [geom_point](#point)

**Example:**

```{r, fig.cap="Illustration of using geom_bin_2d"}
ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) +
  geom_bin2d() + 
  theme(aspect.ratio = 1)
```


## geom_blank

**Package: ** ggplot2 [@R-ggplot2]

**Description: ** Draws nothing.

## geom_boxplot


**Package: ** ggplot2 [@R-ggplot2]

**Description: ** Draw a bar proportional to the specified number. For example, number of cases or user defined number.

**Statistics layer(s): ** 

  `stat_boxplot` - This the default statistics layer. This computes minimum, maximum, median, first quartile ($Q1$), third quartile ($Q3$), upper whisker extends up to $Q3 + 1.5 \times IQR$ and lower whisker extends up to $Q1 - 1.5 \times IQR$, where $IQR = Q3 - Q1$. In a notched box plot, it creates 95\% confidence interval for mean.
  

**See also: ** [geom_col](#col)

```{r, fig.cap="Illustration of using geom_boxplot"}
ggplot(elephants, aes(y = Weight)) + 
  geom_boxplot()
```

```{r, fig.cap="Illustration of using geom_boxplot with changing outliers and adding a notch to create notched box plot."}
ggplot(elephants, aes(y = Weight)) + 
geom_boxplot(outlier.colour="black", outlier.shape=16,
             outlier.size=2, notch=TRUE)

```





<!--chapter:end:05-b.Rmd-->

# C: geom_c...

## geom_col

Before using `geom_col`, you need to create a summary table of counts or you can apply `geom_col` for a summary table already given.

```{r, echo=FALSE}
elephants_counts <- elephants |> 
  group_by(Age_Category) |> 
  summarise(n = n())
elephants_counts
```



```{r, echo=FALSE}
ggplot(elephants_counts, aes(x = Age_Category, y=n)) + 
  geom_col()
```


<!--chapter:end:06-c.Rmd-->

# D: geom_d...


## geom_delaunay_tile

**Description:** The Delaunay triangulation is used to create a planar graph.



```{r}
delaunay <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) +
  ggforce::geom_delaunay_tile(alpha = 0.5, colour = 'black') + labs(title="geom_delaunay_tile") + theme(aspect.ratio = 1)

# to compare with geom_point
point <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) +
  geom_point(alpha = 0.5, colour = 'black') + labs(title="geom_point") + theme(aspect.ratio = 1)

library(patchwork)
delaunay|point
```



## geom_density


```{r}
ggplot(elephants, aes(x = Weight)) + 
  geom_density()

```

## geom_density_2d

```{r}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_density_2d()

```

## geom_density_2d_filled

```{r}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_density_2d_filled()

```



## geom_density_ridges

Here the `y` variable should be qualitative and the `x` variable should be quantitative.


```{r}
library(ggridges)
ggplot(elephants, aes(y=Category, x = Height)) + 
    geom_density_ridges()

```

## geom_dl

```{r}
library(directlabels)
ggplot(elephants, aes(y = Height, x=Weight, col=Category)) + 
  geom_point() +
  geom_dl(aes(label=Category),method="smart.grid")
```

<!--chapter:end:07-d.Rmd-->

# E: geom_e...


## geom_encircle


Other related geoms: geom_mark_circle

```{r, echo=FALSE}
library(ggalt)
ggplot(elephants, aes(y = Height, x=Weight, col=Category)) + 
 geom_encircle(aes(fill =Category), s_shape=0.2, expand=0.01 , alpha=0.4) 
```

`geom_encircle` with `geom_point`

```{r, echo=FALSE}
library(ggalt)
ggplot(elephants, aes(y = Height, x=Weight, col=Category)) + 
  geom_point() + geom_encircle(aes(fill =Category), s_shape=0.2, expand=0.01 , alpha=0.4) 
```

<!--chapter:end:08-e.Rmd-->

# F: geom_f...

## geom_function

```{r}
ggplot() + xlim(c(-1,1)) + geom_function(fun=cos, colour="red",lwd=1, linetype=1)

```


<!--chapter:end:09-f.Rmd-->

# A: geom_axxxxx

<!--chapter:end:10-g.Rmd-->

# H: geom_h...


## geom_histogram{#histogram}

```{r, echo=FALSE}
ggplot(elephants, aes(x = Weight)) + 
  geom_histogram(col="white")

```

## geom_hline{#hline}


**Package: ** ggplot2 [@R-ggplot2]

**Book: **

**Description: ** Draw a horizontal line ($Y=c$) for a given value of $c$, which is known as `yintercept`.

**See also: ** [geom_point](#point), [geom_vline](#vline), [geom_hline](#hline)

**Example:**

```{r, fig.cap="Illustration of (A) geom_hline and (B) use of geom_point and geom_hline both"}
hline <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) + geom_hline(yintercept = 2.5) + 
  labs(title="A: `geom_hline` only") +
  theme(aspect.ratio = 1)

pointhline <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) + 
  geom_point() + 
  geom_hline(yintercept = 2.5) + 
  labs(title="B: `geom_point + geom_hline` both") +
  theme(aspect.ratio = 1)


hline | pointhline
```

<!--chapter:end:11-h.Rmd-->

# A: geom_axxxxx

<!--chapter:end:12-i.Rmd-->

# A: geom_axxxxx

<!--chapter:end:13-j.Rmd-->

# A: geom_axxxxx

<!--chapter:end:14-k.Rmd-->

# L: geom_l...

## geom_label_repel

```{r}
ggplot(elephants.subset.100, aes(y = Height, x=Weight)) +
  geom_point() +
  ggrepel::geom_label_repel(aes(y = Height, x=Weight, 
                                label = rownames(elephants.subset.100)),
                                fontface = 'bold', color = 'red',
                                box.padding = unit(0.40, "lines"),
                                point.padding = unit(0.6, "lines"),
                                segment.color = 'grey50'
  )
```


## geom_lm


```{r, echo=FALSE}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_lm()
```

<!--chapter:end:15-l.Rmd-->

# M: geom_m...


## geom_mark_circle

```{r, echo=FALSE}
library(ggforce)
ggplot(elephants, aes(y = Height, x=Weight)) +
  geom_mark_circle(aes(fill = Category, label = Category),
                   con.cap = 0) 
```

With geom_point

```{r, echo=FALSE}
library(ggforce)
ggplot(elephants, aes(y = Height, x=Weight)) +
  geom_mark_circle(aes(fill = Category, label = Category),
                   con.cap = 0) +
  geom_point()
```

<!--chapter:end:16-m.Rmd-->

# A: geom_axxxxx

<!--chapter:end:17-n.Rmd-->

# A: geom_axxxxx

<!--chapter:end:18-o.Rmd-->

# P: geom_p...

## geom_point{#point}

```{r, echo=FALSE}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_point()
```

<!--chapter:end:19-p.Rmd-->

# A: geom_axxxxx

<!--chapter:end:20-q.Rmd-->

# A: geom_axxxxx

<!--chapter:end:21-r.Rmd-->

# S: geom_s...


## geom_signif

```{r}
ggplot(elephants, aes(y = Weight, x=Category)) + geom_boxplot() + ggsignif::geom_signif()
```

## geom_smooth

```{r, echo=FALSE}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_smooth()

```

```{r, echo=FALSE}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_smooth(method=lm)

```

```{r, echo=FALSE}
ggplot(elephants, aes(y = Height, x=Weight)) + 
  geom_smooth(method = lm, formula = y ~ splines::bs(x, 4))

```

<!--chapter:end:22-s.Rmd-->

# A: geom_axxxxx

<!--chapter:end:23-t.Rmd-->

# A: geom_axxxxx

<!--chapter:end:24-u.Rmd-->

# V: geom_v...

## geom_vline{#vline}


**Package: ** ggplot2 [@R-ggplot2]

**Book: **

**Description: ** Draw a vertical line ($X=c$) for a given value of $c$, which is known as `xintercept`.

**See also: ** [geom_point](#point), [geom_vline](#vline), [geom_hline](#hline)

**Example:**

```{r, fig.cap="Illustration of (A) geom_vline and (B) use of geom_point and geom_vline both"}
vline <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) + geom_vline(xintercept = 1.25) + 
  labs(title="A: `geom_vline` only") +
  theme(aspect.ratio = 1)

pointvline <- ggplot(elephants.subset.100, aes(y = Height, x=Fore_Feet_Circumference)) + 
  geom_point() + 
  geom_vline(xintercept = 1.25) + 
  labs(title="B: `geom_point + geom_vline` both") +
  theme(aspect.ratio = 1)

library(patchwork)
vline | pointvline
```

## geom_violin

```{r, echo=FALSE}
ggplot(elephants, aes(y = Weight, x=Category)) + 
  geom_violin()

```

Without trimming

```{r, echo=FALSE}
ggplot(elephants, aes(y = Weight, x=Category)) + 
  geom_violin(trim=FALSE)

```


Draw quantiles

```{r, echo=FALSE}
ggplot(elephants, aes(y = Weight, x=Category)) + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75))

```

<!--chapter:end:25-v.Rmd-->

# A: geom_axxxxx

<!--chapter:end:26-w.Rmd-->

# A: geom_axxxxx

<!--chapter:end:27-x.Rmd-->

# A: geom_axxxxx

<!--chapter:end:28-y.Rmd-->

# A: geom_axxxxx

<!--chapter:end:29-z.Rmd-->

# Others

## ggpairs

With all variables

```{r, echo=TRUE, warning=FALSE, message=FALSE}
GGally::ggpairs(elephants)
```

With only numeric variables

```{r, echo=TRUE, warning=FALSE, message=FALSE}
elephants.numeric <- elephants |> select_if(is.numeric)     
GGally::ggpairs(elephants.numeric)
```

Colour the points according to category

```{r, echo=TRUE, warning=FALSE, message=FALSE}
elephants.numeric <- elephants |> select_if(is.numeric) 
elephants.numeric$Category <- elephants$Category
GGally::ggpairs(elephants.numeric, aes(col=Category))
```


<!--chapter:end:30-others.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:31-references.Rmd-->

